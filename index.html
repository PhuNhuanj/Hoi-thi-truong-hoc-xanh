<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªôi Thi Tr∆∞·ªùng H·ªçc Xanh - Ph√∫ Nhu·∫≠n 2025 (Tournament Edition)</title>
    <style>
        :root {
            --primary: #0d6efd;
            --success: #198754;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #0dcaf0;
            --dark: #212529;
            --light: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            /* --- THAY ƒê·ªîI: S·ª≠ d·ª•ng t√™n file ·∫£nh m·ªõi --- */
            /* ƒê·∫£m b·∫£o b·∫°n ƒë√£ l∆∞u ·∫£nh v·ªõi t√™n background_hoithi.jpg c√πng th∆∞ m·ª•c */
            background-image: url('background_hoithi.jpg'); 
            background-size: cover;       /* H√¨nh ·∫£nh ph·ªß k√≠n m√†n h√¨nh */
            background-position: center bottom;  /* CƒÉn gi·ªØa v√† ∆∞u ti√™n ph·∫ßn d∆∞·ªõi c·ªßa ·∫£nh (n∆°i c√≥ ho·∫°t ƒë·ªông) */
            background-repeat: no-repeat; /* Kh√¥ng l·∫∑p l·∫°i h√¨nh */
            background-attachment: fixed; /* C·ªë ƒë·ªãnh h√¨nh khi cu·ªôn */
            
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
        }

        /* --- M√ÄN H√åNH CH·ªú & ƒêƒÇNG K√ù --- */
        .full-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            /* N·ªÅn tr·∫Øng m·ªù m·∫°nh h∆°n ƒë·ªÉ l√†m n·ªïi b·∫≠t ch·ªØ tr√™n n·ªÅn s·∫∑c s·ª° */
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(8px); 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: var(--dark);
            transition: opacity 0.3s;
        }

        .input-group {
            margin: 20px 0;
            text-align: center;
        }

        input[type="text"] {
            padding: 15px;
            font-size: 1.5rem;
            border-radius: 10px;
            border: 2px solid var(--primary); /* Vi·ªÅn m√†u xanh ch·ªß ƒë·∫°o */
            width: 300px;
            text-align: center;
            margin-bottom: 20px;
            background: white;
            color: var(--dark);
            font-weight: bold;
        }

        .btn-large {
            padding: 15px 40px;
            font-size: 1.5rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            background: linear-gradient(45deg, var(--warning), #ffdb58); /* Gradient v√†ng s√°ng */
            color: var(--dark);
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
        }
        .btn-large:hover { transform: scale(1.05); box-shadow: 0 8px 25px rgba(255, 193, 7, 0.6); }

        /* --- B·∫¢NG X·∫æP H·∫†NG --- */
        .leaderboard-box {
            background: rgba(255, 255, 255, 0.95);
            color: black;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 2px solid var(--primary);
        }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-size: 1.2rem; }
        th { background: var(--primary); color: white; }
        tr:nth-child(1) td { font-weight: bold; color: #d63384; font-size: 1.3rem; background-color: #fff0f5;} 
        
        /* --- GAME UI --- */
        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 100;
            height: 70px;
            border-bottom: 3px solid var(--success);
        }

        .team-name { font-size: 1.5rem; font-weight: bold; color: var(--primary); text-transform: uppercase; }
        
        .hud {
            display: flex;
            gap: 20px;
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .timer-box { color: var(--danger); background: #fff5f5; padding: 5px 15px; border-radius: 8px; border: 2px solid var(--danger); }
        .score-box { color: var(--success); background: #f0fff4; padding: 5px 15px; border-radius: 8px; border: 2px solid var(--success); }

        #btn-submit {
            background: linear-gradient(45deg, var(--danger), #ff6b6b);
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 1.2rem;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.4);
            transition: all 0.2s;
        }
        #btn-submit:hover { transform: scale(1.05); }
        #btn-submit:disabled { background: #ccc; cursor: default; box-shadow: none; transform: none;}

        /* --- GAME AREA --- */
        #game-container {
            display: flex;
            flex: 1;
            flex-direction: column;
            position: relative;
        }

        #play-area {
            flex: 1;
            position: relative;
            /* N·ªÅn trong su·ªët nh·∫π ƒë·ªÉ th·∫•y h√¨nh n·ªÅn vui nh·ªôn ph√≠a sau */
            background-color: rgba(255, 255, 255, 0.7); 
            border-bottom: 3px solid #ccc;
        }

        /* --- TRASH ITEMS --- */
        .trash-card {
            width: 110px;
            height: 110px;
            position: absolute;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: grab;
            transition: transform 0.2s;
            z-index: 50;
            border: 3px solid white; /* Vi·ªÅn d√†y h∆°n */
            padding: 5px;
        }

        .trash-card:active { cursor: grabbing; transform: scale(1.1); z-index: 100; border-color: var(--warning); }
        
        .trash-img { width: 60px; height: 60px; object-fit: contain; margin-bottom: 5px; filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.1)); }
        .trash-label { font-size: 0.9rem; font-weight: bold; text-align: center; line-height: 1.1; color: #495057; }

        /* --- BINS --- */
        #bins-area {
            height: 250px;
            display: flex;
            justify-content: space-evenly;
            align-items: flex-end;
            padding: 10px;
            background: rgba(255, 255, 255, 0.85); /* N·ªÅn khu v·ª±c th√πng r√°c s√°ng h∆°n */
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
        }

        .bin-zone {
            width: 30%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .bin-storage {
            flex: 1;
            background: rgba(255,255,255,0.6);
            border: 4px dashed #adb5bd; /* Vi·ªÅn n√©t ƒë·ª©t d√†y h∆°n */
            border-radius: 15px 15px 0 0;
            margin-bottom: 0;
            padding: 5px;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            justify-content: center;
            overflow-y: auto;
            transition: all 0.3s;
        }

        .bin-storage.drag-over { background: rgba(255, 235, 59, 0.5); border-color: var(--warning); transform: scale(1.02); }

        .bin-header {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.3rem; /* Ch·ªØ to h∆°n */
            text-transform: uppercase;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .trash-card.in-bin {
            position: static !important;
            width: 60px !important;
            height: 60px !important;
            margin: 3px;
            border: 2px solid #ddd;
            box-shadow: none;
        }
        .trash-card.in-bin .trash-img { width: 35px; height: 35px; margin-bottom: 0; }
        .trash-card.in-bin .trash-label { font-size: 0.6rem; display: none; }

        .bg-organic { background: linear-gradient(to bottom, var(--success), #28a745); }
        .bg-recycle { background: linear-gradient(to bottom, var(--info), #0dcaf0); }
        .bg-other { background: linear-gradient(to bottom, var(--dark), #343a40); }

        .hidden { display: none !important; }

        .btn-link { background: none; border: none; color: var(--primary); text-decoration: underline; cursor: pointer; margin-top: 15px; font-weight: bold; font-size: 1.1rem;}
        
        /* Ti√™u ƒë·ªÅ ch√≠nh c√≥ vi·ªÅn ch·ªØ ƒë·ªÉ n·ªïi b·∫≠t tr√™n n·ªÅn ƒë·ªông */
        h1.main-title {
             color: var(--primary);
             text-transform: uppercase;
             font-size: 3.5rem;
             text-align: center;
             /* T·∫°o vi·ªÅn tr·∫Øng xung quanh ch·ªØ */
             text-shadow: 
                2px 2px 0 #fff,
                -2px 2px 0 #fff,
                2px -2px 0 #fff,
                -2px -2px 0 #fff,
                0px 4px 10px rgba(0,0,0,0.3);
             margin-bottom: 10px;
        }
        h2.sub-title {
            color: var(--dark);
            font-weight: bold;
            background: rgba(255,255,255,0.8);
            padding: 5px 15px;
            border-radius: 20px;
        }

    </style>
</head>
<body>

    <div id="screen-register" class="full-screen">
        <h1 class="main-title">H·ªôi Thi Tr∆∞·ªùng H·ªçc Xanh</h1>
        <h2 class="sub-title">Ph·∫ßn thi: Th·ª±c h√†nh Ph√¢n lo·∫°i r√°c</h2>
        
        <div class="input-group" style="background: rgba(255,255,255,0.9); padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);">
            <p style="font-weight: bold; font-size: 1.2rem; color: var(--primary);">Nh·∫≠p t√™n ƒê∆°n v·ªã / Tr∆∞·ªùng h·ªçc:</p>
            <input type="text" id="inp-team-name" placeholder="V√≠ d·ª•: Ti·ªÉu h·ªçc A..." autocomplete="off">
            <br>
            <button class="btn-large" onclick="goToGame()">B·∫ÆT ƒê·∫¶U THI NGAY!</button>
        </div>
        
        <button class="btn-link" onclick="showLeaderboard()">Xem B·∫£ng X·∫øp H·∫°ng</button>
    </div>

    <div id="screen-leaderboard" class="full-screen hidden">
        <h2 style="color: var(--primary); text-shadow: 2px 2px 0px white; font-size: 3rem; margin-bottom: 20px;">üèÜ B·∫¢NG T·ªîNG S·∫ÆP üèÜ</h2>
        <div class="leaderboard-box">
            <table id="tbl-leaderboard">
                <thead>
                    <tr>
                        <th>H·∫°ng</th>
                        <th>ƒê∆°n v·ªã</th>
                        <th>ƒêi·ªÉm</th>
                        <th>Th·ªùi gian c√≤n l·∫°i</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div style="margin-top: 20px; background: rgba(255,255,255,0.8); padding: 15px; border-radius: 15px;">
            <button class="btn-large" style="font-size: 1.2rem; padding: 10px 30px;" onclick="backToRegister()">Quay l·∫°i</button>
            <button class="btn-link" style="color: var(--danger); margin-left: 20px;" onclick="clearData()">X√≥a d·ªØ li·ªáu</button>
        </div>
    </div>

    <div id="screen-game" class="hidden" style="width: 100%; height: 100%; display: flex; flex-direction: column;">
        <header>
            <div class="team-name" id="display-team-name">ƒê·ªòI THI: ???</div>
            <button id="btn-submit" onclick="submitGame()">N·ªòP B√ÄI (K·∫æT TH√öC)</button>
            <div class="hud">
                <div class="timer-box">‚è≥ <span id="timer">04:00</span></div>
                <div class="score-box" style="display:none">ƒêi·ªÉm: <span id="score">0</span></div> </div>
        </header>

        <div id="game-container">
            <div id="play-area"></div>

            <div id="bins-area">
                <div class="bin-zone">
                    <div class="bin-storage" id="bin-organic" data-type="organic"></div>
                    <div class="bin-header bg-organic">üçè R√ÅC TH·ª∞C PH·∫®M</div>
                </div>
                <div class="bin-zone">
                    <div class="bin-storage" id="bin-recycle" data-type="recycle"></div>
                    <div class="bin-header bg-recycle">‚ôªÔ∏è R√ÅC T√ÅI CH·∫æ</div>
                </div>
                <div class="bin-zone">
                    <div class="bin-storage" id="bin-other" data-type="other"></div>
                    <div class="bin-header bg-other">üóëÔ∏è R√ÅC C√íN L·∫†I</div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-result" class="full-screen hidden" style="background: rgba(0,0,0,0.85); backdrop-filter: blur(15px);">
        <h1 style="color: white; text-shadow: 0 0 10px var(--warning);">üéâ K·∫æT QU·∫¢ üéâ</h1>
        <div style="background: white; padding: 40px; border-radius: 30px; text-align: center; color: black; box-shadow: 0 0 50px rgba(255,255,255,0.5); border: 5px solid var(--warning);">
            <h2 id="res-team" style="color: var(--primary); font-size: 2rem;">ƒê·ªôi: ABC</h2>
            <h1 id="res-score" style="font-size: 6rem; margin: 20px 0; color: var(--danger); font-weight: 900;">45/50</h1>
            <p id="res-msg" style="font-size: 1.5rem; font-weight: bold; color: var(--success);">C·ªë g·∫Øng l√™n nh√©!</p>
            <button class="btn-large" style="margin-top: 20px;" onclick="saveAndExit()">L∆ØU K·∫æT QU·∫¢ & RA NGO√ÄI</button>
        </div>
    </div>

    <script>
        // --- 1. C√îNG NGH·ªÜ T·∫†O H√åNH ·∫¢NH T·ª∞ ƒê·ªòNG (SVG) ---
        function createSVGIcon(emoji, bgColor) {
            const svg = `
            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="${bgColor}" stroke="#333" stroke-width="3"/> <text x="50" y="62" font-size="55" text-anchor="middle" font-family="Segoe UI Emoji, Arial">${emoji}</text>
            </svg>`;
            return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
        }

        // --- 2. NG√ÇN H√ÄNG ƒê·ªÄ THI ---
        const trashDatabase = [
            // --- NH√ìM TH·ª∞C PH·∫®M ---
            { name: "V·ªè chu·ªëi", type: "organic", icon: "üçå", color: "#d4edda" },
            { name: "X∆∞∆°ng c√°", type: "organic", icon: "üêü", color: "#d4edda" },
            { name: "Rau h√©o", type: "organic", icon: "ü•¨", color: "#d4edda" },
            { name: "V·ªè tr·ª©ng", type: "organic", icon: "ü•ö", color: "#d4edda" },
            { name: "B√£ tr√†", type: "organic", icon: "ü´ñ", color: "#d4edda" },
            { name: "C∆°m th·ª´a", type: "organic", icon: "üçö", color: "#d4edda" },
            { name: "V·ªè cam", type: "organic", icon: "üçä", color: "#d4edda" },
            { name: "B√°nh m√¨ c≈©", type: "organic", icon: "ü•ñ", color: "#d4edda" },
            { name: "H·∫°t xo√†i", type: "organic", icon: "ü•≠", color: "#d4edda" },
            { name: "Hoa t√†n", type: "organic", icon: "ü•Ä", color: "#d4edda" },
            // --- NH√ìM T√ÅI CH·∫æ ---
            { name: "Chai nh·ª±a", type: "recycle", icon: "üçæ", color: "#cff4fc" },
            { name: "Lon n∆∞·ªõc", type: "recycle", icon: "ü•§", color: "#cff4fc" },
            { name: "Gi·∫•y b√°o", type: "recycle", icon: "üì∞", color: "#cff4fc" },
            { name: "H·ªôp c√°c-t√¥ng", type: "recycle", icon: "üì¶", color: "#cff4fc" },
            { name: "S√°ch c≈©", type: "recycle", icon: "üìö", color: "#cff4fc" },
            { name: "Lon ƒë·ªì h·ªôp", type: "recycle", icon: "ü•´", color: "#cff4fc" },
            { name: "Chai th·ªßy tinh", type: "recycle", icon: "üè∫", color: "#cff4fc" },
            { name: "Th√¨a inox", type: "recycle", icon: "ü•Ñ", color: "#cff4fc" },
            { name: "V·ªü h·ªçc sinh", type: "recycle", icon: "üìí", color: "#cff4fc" },
            { name: "Gh·∫ø nh·ª±a h·ªèng", type: "recycle", icon: "ü™ë", color: "#cff4fc" },
            // --- NH√ìM C√íN L·∫†I ---
            { name: "T√∫i nilon", type: "other", icon: "üõçÔ∏è", color: "#e2e3e5" },
            { name: "Kh·∫©u trang", type: "other", icon: "üò∑", color: "#e2e3e5" },
            { name: "Ly s√†nh v·ª°", type: "other", icon: "üçµ", color: "#e2e3e5" },
            { name: "T√£ gi·∫•y", type: "other", icon: "üß∑", color: "#e2e3e5" },
            { name: "Gi·∫•y ƒÉn b·∫©n", type: "other", icon: "ü§ß", color: "#e2e3e5" },
            { name: "G√≥i k·∫πo", type: "other", icon: "üç¨", color: "#e2e3e5" },
            { name: "G√≥i snack", type: "other", icon: "üçü", color: "#e2e3e5" },
            { name: "B√∫t bi h·∫øt m·ª±c", type: "other", icon: "üñäÔ∏è", color: "#e2e3e5" },
            { name: "G∆∞∆°ng v·ª°", type: "other", icon: "ü™û", color: "#e2e3e5" },
            { name: "B·∫≠t l·ª≠a", type: "other", icon: "üî•", color: "#e2e3e5" },
            // --- C√ÅC C√ÇU H·ªéI B·∫™Y ---
            { name: "Ly gi·∫•y cafe", type: "other", icon: "‚òï", color: "#fff3cd" }, 
            { name: "H·ªôp x·ªëp b·∫©n", type: "other", icon: "ü•°", color: "#fff3cd" }, 
            { name: "Pin c≈©", type: "other", icon: "üîã", color: "#fff3cd" },
            { name: "·ªêng h√∫t", type: "other", icon: "üßÉ", color: "#fff3cd" },
        ];

        // --- 3. QU·∫¢N L√ù GAME ---
        let currentTeam = "";
        let gameTimer;
        let timeLeft = 240; 
        let finalScore = 0;
        let isPlaying = false;

        function init() {
            if(!localStorage.getItem('greenSchoolData')) {
                localStorage.setItem('greenSchoolData', JSON.stringify([]));
            }
        }
        init();

        function goToGame() {
            const nameInput = document.getElementById('inp-team-name');
            if (nameInput.value.trim() === "") {
                alert("Vui l√≤ng nh·∫≠p t√™n ƒê∆°n v·ªã!");
                return;
            }
            currentTeam = nameInput.value.trim();
            document.getElementById('display-team-name').innerText = "ƒê·ªòI THI: " + currentTeam;
            
            document.getElementById('screen-register').classList.add('hidden');
            document.getElementById('screen-game').classList.remove('hidden');
            
            startGame();
        }

        function startGame() {
            timeLeft = 240;
            isPlaying = true;
            document.getElementById('btn-submit').disabled = false;
            document.getElementById('btn-submit').innerText = "N·ªòP B√ÄI (K·∫æT TH√öC)";
            updateTimerDisplay();

            document.getElementById('play-area').innerHTML = '';
            document.querySelectorAll('.bin-storage').forEach(b => b.innerHTML = '');

            spawnTrash(15);

            clearInterval(gameTimer);
            gameTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    submitGame();
                }
            }, 1000);
        }

        function spawnTrash(count) {
            const area = document.getElementById('play-area');
            const shuffled = [...trashDatabase].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, count);

            selected.forEach((item, i) => {
                const el = document.createElement('div');
                el.classList.add('trash-card');
                el.id = 'trash-' + i;
                el.dataset.type = item.type;

                const img = document.createElement('img');
                img.src = createSVGIcon(item.icon, item.color);
                img.classList.add('trash-img');
                
                const lbl = document.createElement('div');
                lbl.classList.add('trash-label');
                lbl.innerText = item.name;

                el.appendChild(img);
                el.appendChild(lbl);

                const maxX = area.clientWidth - 120;
                const maxY = area.clientHeight - 120;
                el.style.left = Math.random() * maxX + 'px';
                el.style.top = Math.random() * maxY + 'px';

                setupDrag(el);
                area.appendChild(el);
            });
        }

        // --- X·ª¨ L√ù K√âO TH·∫¢ ---
        let activeItem = null;
        let startX, startY, startLeft, startTop;

        function setupDrag(el) {
            el.addEventListener('mousedown', dragStart);
            el.addEventListener('touchstart', dragStart, {passive: false});
        }

        function dragStart(e) {
            if (!isPlaying) return;
            if (e.type === 'touchstart') e.preventDefault();
            
            activeItem = this;
            
            if (activeItem.classList.contains('in-bin')) {
                activeItem.classList.remove('in-bin');
                activeItem.style.position = 'absolute';
                document.getElementById('play-area').appendChild(activeItem);
            }

            const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            
            startX = clientX;
            startY = clientY;
            
            const rect = activeItem.getBoundingClientRect();
            const areaRect = document.getElementById('play-area').getBoundingClientRect();
            
            startLeft = rect.left - areaRect.left;
            startTop = rect.top - areaRect.top;

            activeItem.style.left = startLeft + 'px';
            activeItem.style.top = startTop + 'px';

            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);
            document.addEventListener('touchmove', dragMove, {passive: false});
            document.addEventListener('touchend', dragEnd);
        }

        function dragMove(e) {
            if (!activeItem) return;
            if (e.type === 'touchmove') e.preventDefault();

            const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;

            const dx = clientX - startX;
            const dy = clientY - startY;

            activeItem.style.left = (startLeft + dx) + 'px';
            activeItem.style.top = (startTop + dy) + 'px';

            document.querySelectorAll('.bin-storage').forEach(bin => {
                const rect = bin.getBoundingClientRect();
                if (clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom) {
                    bin.classList.add('drag-over');
                } else {
                    bin.classList.remove('drag-over');
                }
            });
        }

        function dragEnd(e) {
            if (!activeItem) return;
            
            document.removeEventListener('mousemove', dragMove);
            document.removeEventListener('mouseup', dragEnd);
            document.removeEventListener('touchmove', dragMove);
            document.removeEventListener('touchend', dragEnd);

            const rect = activeItem.getBoundingClientRect();
            const center_x = rect.left + rect.width/2;
            const center_y = rect.top + rect.height/2;

            let droppedBin = null;
            document.querySelectorAll('.bin-storage').forEach(bin => {
                bin.classList.remove('drag-over');
                const bRect = bin.getBoundingClientRect();
                if (center_x >= bRect.left && center_x <= bRect.right && center_y >= bRect.top && center_y <= bRect.bottom) {
                    droppedBin = bin;
                }
            });

            if (droppedBin) {
                droppedBin.appendChild(activeItem);
                activeItem.classList.add('in-bin');
                activeItem.style.left = 'auto';
                activeItem.style.top = 'auto';
                activeItem.dataset.choice = droppedBin.dataset.type;
            } else {
                const area = document.getElementById('play-area');
                let finalL = parseInt(activeItem.style.left);
                let finalT = parseInt(activeItem.style.top);
                
                if(finalL < 0) finalL = 0;
                if(finalT < 0) finalT = 0;
                if(finalL > area.clientWidth - 100) finalL = area.clientWidth - 100;
                if(finalT > area.clientHeight - 100) finalT = area.clientHeight - 100;

                activeItem.style.left = finalL + 'px';
                activeItem.style.top = finalT + 'px';
                activeItem.dataset.choice = "";
            }

            activeItem = null;
        }

        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
        }

        function submitGame() {
            if (!isPlaying) return;
            isPlaying = false;
            clearInterval(gameTimer);
            document.getElementById('btn-submit').disabled = true;

            finalScore = 0;
            const allItems = document.querySelectorAll('.trash-card');
            let correctCount = 0;
            const totalItems = allItems.length;

            allItems.forEach(item => {
                const correctType = item.dataset.type;
                const userChoice = item.dataset.choice;

                if (userChoice === correctType) {
                    finalScore += 5; 
                    correctCount++;
                    item.style.border = "4px solid #198754";
                } else if (userChoice) {
                    item.style.border = "4px solid #dc3545";
                }
            });

            setTimeout(() => {
                document.getElementById('res-team').innerText = "ƒê∆°n v·ªã: " + currentTeam;
                document.getElementById('res-score').innerText = finalScore + " ƒëi·ªÉm";
                
                let msg = "";
                if (finalScore == totalItems * 5) msg = "Xu·∫•t s·∫Øc! Tuy·ªát ƒë·ªëi!";
                else if (finalScore >= (totalItems * 5) * 0.8) msg = "R·∫•t t·ªët! B·∫°n r·∫•t am hi·ªÉu!";
                else msg = "C·∫ßn c·ªë g·∫Øng ph√¢n lo·∫°i k·ªπ h∆°n nh√©!";
                
                document.getElementById('res-msg').innerText = `${msg} (ƒê√∫ng ${correctCount}/${totalItems} c√¢u)`;
                document.getElementById('screen-result').classList.remove('hidden');
            }, 1000);
        }

        function saveAndExit() {
            const data = JSON.parse(localStorage.getItem('greenSchoolData'));
            const newRecord = {
                team: currentTeam,
                score: finalScore,
                timeLeft: timeLeft, 
                timestamp: new Date().getTime()
            };
            data.push(newRecord);
            localStorage.setItem('greenSchoolData', JSON.stringify(data));
            location.reload();
        }

        function showLeaderboard() {
            document.getElementById('screen-register').classList.add('hidden');
            document.getElementById('screen-leaderboard').classList.remove('hidden');
            
            const tbody = document.querySelector('#tbl-leaderboard tbody');
            tbody.innerHTML = "";
            
            const data = JSON.parse(localStorage.getItem('greenSchoolData'));
            
            data.sort((a, b) => {
                if (b.score !== a.score) return b.score - a.score;
                return b.timeLeft - a.timeLeft;
            });

            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                const m = Math.floor(row.timeLeft / 60);
                const s = row.timeLeft % 60;
                const timeStr = `${m}:${s < 10 ? '0'+s : s}`;
                
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td style="text-align:left; padding-left:20px; font-weight: 500;">${row.team}</td>
                    <td style="font-weight:900; color: var(--primary); font-size: 1.3rem;">${row.score}</td>
                    <td>${timeStr}</td>
                `;
                tbody.appendChild(tr);
            });

            if (data.length === 0) {
                tbody.innerHTML = "<tr><td colspan='4' style='padding: 30px; color: #6c757d;'>Ch∆∞a c√≥ d·ªØ li·ªáu thi ƒë·∫•u</td></tr>";
            }
        }

        function backToRegister() {
            document.getElementById('screen-leaderboard').classList.add('hidden');
            document.getElementById('screen-register').classList.remove('hidden');
        }

        function clearData() {
            if(confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ thi ƒë·∫•u kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.")) {
                localStorage.removeItem('greenSchoolData');
                alert("ƒê√£ x√≥a d·ªØ li·ªáu!");
                showLeaderboard();
            }
        }

    </script>
</body>
</html>
```
